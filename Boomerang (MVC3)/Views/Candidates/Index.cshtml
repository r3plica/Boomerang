@using System.Collections.ObjectModel
@using Core
@model Collection<Candidate>

@{
    ViewBag.Title = "Candidates";
}

@section navigation
{
	<li>@Html.ActionLink("Index", "Index", "Home")<span></span></li>
	<li>@Html.ActionLink("Clients", "Index", "Clients")<span></span></li>
	<li id="current">@Html.ActionLink("Candidates", "Index", "Candidates")<span></span></li>
	<li>@Html.ActionLink("Users", "Index", "Users")<span></span></li>
	<li>@Html.ActionLink("Profile", "Index", "Account")<span></span></li>
	<li>@Html.ActionLink("Lists", "Index", "Lists")<span></span></li>
}

<div class="container">
    <div class="row">
        <div class="eightcol">
        
            <h2>@ViewBag.Title</h2>
                       
            <p class="message"></p>
            
            <div class="pagination"><div class="page_navigation"></div></div>
			<table class="default-table candidates"> 
                <thead>            
				    <tr>
                        <th><span class="tick"></span></th>
					    <th>Forname</th>
					    <th>Surname</th>
					    <th>Email</th>
					    <th>DOB</th>
					    <th>Active</th>
				    </tr>
                </thead> 
                <tbody>
                    @foreach (Candidate Candidate in Model)
                    {
                        <tr id="@Candidate.Id">
                            <td><span class="tick"></span></td>
                            <td>@Candidate.Forename</td>
                            <td>@Candidate.Surname</td>
                            <td>jaymie.jeffrey@skipstone.co.uk</td>
                            <td>@Candidate.DOB</td>
                            <td>
                                @if (Candidate.Active)
                                {
                                    <input type="checkbox" disabled="disabled" checked="checked" />
                                }
                                else
                                {
                                    <input type="checkbox" disabled="disabled" />
                                }  
                            </td>
                        </tr>
                    }
                </tbody>
            </table>

        </div>
        <div class="fourcol last">
            <h2>Actions</h2>
            <div class="form">
                <ul class="actions">
                    <li><a href="/Candidates/Create" class="button" id="create">Create a new candidate</a></li>
                    <li><a href="#" class="button" id="edit">Edit the selected candidate</a></li>
                    <li><a href="#" class="button" id="delete">Delete the selected candidate</a></li>
                    <li><a href="#" class="button" id="active">Mark the selected candidate active</a></li>
                    <li><a href="#" class="button" id="inactive">Mark the selected candidate in-active</a></li>
                    <li><a href="#" class="button" id="cv">View the selected candidate CV</a></li>
                </ul>
            </div>

            <div class="form">
                <input type="checkbox" checked="checked" /> Show only active
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    var settings = {
        selectedColumn: 1,
        ignoreColumns: [0],
        onComplete: function () {
            $('.page_navigation').paginate({ collection: 'tbody > tr', recordsperpage: 20, container: 'tbody > tr' });
        }
    };
    var pMessage = $('.message');

    $(function () {
        $('.candidates').sortTable(settings);
        displayButtons('.candidates');

        $('.candidates').live('click', function () {
            displayButtons('.candidates');
        });

        $('#edit').click(function (e) {
            e.preventDefault();
            window.location = '/Candidates/Edit/' + $('tbody tr.selected', '.candidates').attr('id');
        });

        $('#delete').click(function (e) {
            e.preventDefault();
            deleteCandidates();
        });
    });

    function deleteCandidates() {
        $.each($('tbody tr.selected', '.candidates'), function () {
            deleteCandidate($(this).attr('id'));
        });
    };

    function deleteCandidate(id) {
        $.ajax({
            url: '@Url.Action("Delete", "Candidates")',
            type: 'POST',
            data: '{ "Id": ' + id + ' }',
            dataType: 'text json',
            contentType: 'application/json; charset=utf-8',
            traditional: true,
            success: function (o) {
                if (o.success) {
                    $('#' + id).remove();
                    pMessage.show().addClass('ui-state-highlight').text('Your Candidates have been deleted.');
                } else {
                    pMessage.show().addClass('ui-state-error').removeClass('ui-state-highlight').text(o.error);
                }
            },
            error: function (XMLHttpRequest, textStatus, errorThrown) {
                pMessage.show().addClass('ui-state-error').removeClass('ui-state-highlight').text('An unspecified error has occured. Please contact the administrator (error code: 106).');
            }
        });
    };
</script>
